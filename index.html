<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AirDrop — LittlePepe</title>
<link rel="stylesheet" href="style.css" />
<link rel="icon" href="logo.svg" type="image/svg+xml">
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
<style>
/* Минимальная стилизация */
.modal-bg {
  display: none;
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.7);
  justify-content:center;
  align-items:center;
  z-index:1000;
}
.modal {
  background:#121212;
  padding:20px;
  border-radius:8px;
  color:#fff;
  text-align:center;
  width:250px;
}
.wallet-btn { margin:10px 0; padding:10px; width:100%; background:#4caf50; border:none; color:#fff; border-radius:5px; cursor:pointer;}
</style>
</head>
<body>

<header class="nav">
  <div class="brand">
    <img src="logo.svg" alt="logo" class="logo"/>
    <div class="brand-text">
      <div class="title">AIR<span>DROP</span></div>
      <div class="subtitle">Live • Product</div>
    </div>
  </div>
</header>

<main class="container">
  <section class="hero card">
    <h1 id="tokenName">Airdrop: <span>LittlePepe</span> Token</h1>
    <p class="lead">
      Connect your wallet (MetaMask, TrustWallet, Ledger) and claim your tokens.
    </p>

    <div class="actions">
      <button id="claimBtn" class="btn success">Claim</button>
      <button id="copyBtn" class="btn" disabled>Copy address</button>
      <button id="disconnectBtn" class="btn ghost hidden">Disable</button>
    </div>

    <div class="wallet-info">
      <div id="addrBox" class="muted">Wallet not connected</div>
      <div id="networkBox" class="muted">Network: —</div>
    </div>
  </section>
</main>

<!-- Кастомная модалка выбора кошелька -->
<div class="modal-bg" id="walletModal">
  <div class="modal">
    <h3>Выберите кошелек</h3>
    <button class="wallet-btn" id="metamaskBtn">MetaMask</button>
    <button class="wallet-btn" id="trustBtn">TrustWallet</button>
    <button class="wallet-btn" id="ledgerBtn">Ledger</button>
    <button class="wallet-btn" id="closeModal">Отмена</button>
  </div>
</div>

<script>
let provider, signer, currentAddress;

// Открытие модалки
document.getElementById("claimBtn").addEventListener("click", () => {
  document.getElementById("walletModal").style.display = "flex";
});

// Закрытие модалки
document.getElementById("closeModal").addEventListener("click", () => {
  document.getElementById("walletModal").style.display = "none";
});

// Метамаск
document.getElementById("metamaskBtn").addEventListener("click", async () => {
  if(window.ethereum) {
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    connectWalletUI();
  } else {
    alert("Установите MetaMask!");
  }
});

// TrustWallet и Ledger через WalletConnect
async function connectWalletConnect() {
  const wcProvider = new WalletConnectProvider.default({
    rpc: { 137: "https://polygon-rpc.com/" },
    qrcode: true
  });
  await wcProvider.enable();
  provider = new ethers.providers.Web3Provider(wcProvider);
  signer = provider.getSigner();
  connectWalletUI();
}

// TrustWallet
document.getElementById("trustBtn").addEventListener("click", connectWalletConnect);
// Ledger
document.getElementById("ledgerBtn").addEventListener("click", connectWalletConnect);

function connectWalletUI() {
  signer.getAddress().then(addr=>{
    currentAddress = addr;
    document.getElementById("addrBox").innerText = addr;
    provider.getNetwork().then(n=>{
      document.getElementById("networkBox").innerText = n.name;
    });
    document.getElementById("copyBtn").disabled = false;
    document.getElementById("disconnectBtn").classList.remove("hidden");
    document.getElementById("walletModal").style.display = "none";
  });
}

// Копирование адреса
document.getElementById("copyBtn").addEventListener("click", () => {
  navigator.clipboard.writeText(currentAddress);
  alert("Адрес скопирован!");
});

// Отключение
document.getElementById("disconnectBtn").addEventListener("click", async () => {
  if(provider && provider.provider && provider.provider.disconnect){
    await provider.provider.disconnect();
  }
  provider = null; signer = null; currentAddress = null;
  document.getElementById("addrBox").innerText = "Wallet not connected";
  document.getElementById("networkBox").innerText = "Network: —";
  document.getElementById("copyBtn").disabled = true;
  document.getElementById("disconnectBtn").classList.add("hidden");
});
</script>

</body>
</html>
