<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Market Sandbox — TV-like Chart</title>

<style>
:root{
  --bg:#0b0f14;
  --text:#e7eef7;
  --muted:#9fb0c3;
  --line:#223044;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui;
}
header{
  padding:10px 14px;
  border-bottom:1px solid var(--line);
}
main{
  padding:10px;
}
canvas{
  width:100%;
  height:650px;
  background:#06090d;
  border:1px solid var(--line);
  border-radius:10px;
  touch-action:none;
}
button{
  padding:8px 12px;
  border-radius:8px;
  border:1px solid var(--line);
  background:#111821;
  color:white;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  Market Sandbox — New Engine
</header>

<main>
  <canvas id="chart"></canvas>
</main>

<script>
(() => {

const canvas = document.getElementById("chart");
const ctx = canvas.getContext("2d");

function resize(){
  const r = canvas.getBoundingClientRect();
  canvas.width = r.width;
  canvas.height = r.height;
}
window.addEventListener("resize",resize);
resize();

function randn(){
  let u=0,v=0;
  while(u===0)u=Math.random();
  while(v===0)v=Math.random();
  return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v);
}

let price = 17000;
let fair = 17000;
let vol = 2;
let drift = 0;
let t=0;

let candles=[];
let cur=null;
let tf=1;
let simTime=0;

function newCandle(p){
  cur={o:p,h:p,l:p,c:p};
}
newCandle(price);

function step(){
  t+=0.01;
  simTime+=0.01;

  if(Math.random()<0.002){
    drift = randn()*0.3;
  }

  if(Math.random()<0.001){
    vol = 1+Math.random()*5;
  }

  fair += drift*0.1;
  const move = randn()*vol*0.5 + (fair-price)*0.02;
  price += move;

  cur.h=Math.max(cur.h,price);
  cur.l=Math.min(cur.l,price);
  cur.c=price;

  if(simTime>tf){
    candles.push(cur);
    if(candles.length>300)candles.shift();
    newCandle(price);
    simTime=0;
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(candles.length<2)return;

  let min=Infinity,max=-Infinity;
  for(let c of candles){
    min=Math.min(min,c.l);
    max=Math.max(max,c.h);
  }

  const pad=(max-min)*0.1;
  min-=pad;
  max+=pad;

  const w=canvas.width;
  const h=canvas.height;

  const cw=w/candles.length;

  candles.forEach((c,i)=>{
    const x=i*cw;
    const yO=h-(c.o-min)/(max-min)*h;
    const yC=h-(c.c-min)/(max-min)*h;
    const yH=h-(c.h-min)/(max-min)*h;
    const yL=h-(c.l-min)/(max-min)*h;

    ctx.strokeStyle=c.c>=c.o?"#3ddc97":"#ff5b6e";
    ctx.beginPath();
    ctx.moveTo(x+cw/2,yH);
    ctx.lineTo(x+cw/2,yL);
    ctx.stroke();

    ctx.fillStyle=c.c>=c.o?"rgba(61,220,151,0.5)":"rgba(255,91,110,0.5)";
    ctx.fillRect(x+cw*0.2,Math.min(yO,yC),cw*0.6,Math.abs(yO-yC));
  });
}

function loop(){
  step();
  draw();
  requestAnimationFrame(loop);
}
loop();

})();
</script>

</body>
</html>
